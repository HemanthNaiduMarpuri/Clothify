{% extends "admin/admin_base.html" %}
{% load static %}

{% block admin_content %}
<h3 class="mb-3">All Customers</h3>

<div class="card shadow-sm">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Customer List</h5>

    <form method="get" class="d-flex align-items-center gap-2 mb-0">
      <label for="sort" class="small text-muted mb-0">Sort:</label>
      <select name="sort" id="sort" class="form-select form-select-sm" onchange="this.form.submit()">
        <option value="latest" {% if current_sort == 'latest' %}selected{% endif %}>
          Latest Users
        </option>
        <option value="oldest" {% if current_sort == 'oldest' %}selected{% endif %}>
          Oldest Users
        </option>
      </select>
      <noscript>
        <button type="submit" class="btn btn-sm btn-outline-secondary">Apply</button>
      </noscript>
    </form>
  </div>

  <div class="card-body p-0">
    <table class="table table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th>S.No</th>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Joined At</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for cust in customers %}
        <tr>
          <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
          <td>{{ cust.user.username}}</td>
          <td>{{ cust.user.email}}</td>
          <td>{{ cust.contact|default:"-" }}</td>
          <td>{{ cust.join_date|date:"d M Y" }}</td>

          <td class="d-flex gap-1">
            <a href="{% url 'user_orders' cust.id %}"
               class="btn btn-sm btn-outline-secondary">
              Purchases
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center text-muted py-3">
            No customers found.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if page_obj.has_next %}
  <div class="text-center mt-3">
    <a
      class="btn btn-outline-primary btn-sm"
      href="?page={{ page_obj.next_page_number }}&sort={{ current_sort }}"
    >
      View More
    </a>
  </div>
{% endif %}

{% endblock %}
