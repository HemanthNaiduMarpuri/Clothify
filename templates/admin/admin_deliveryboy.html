{% extends "admin/admin_base.html" %}
{% load static %}

{% block admin_content %}
<h3 class="mb-3">All Delivery Partners</h3>

<div class="card shadow-sm">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Delivery Boy List</h5>

    <form method="get" class="d-flex align-items-center gap-2 mb-0">
      <label for="sort" class="small text-muted mb-0">Sort:</label>
      <select name="sort" id="sort" class="form-select form-select-sm" onchange="this.form.submit()">
        <option value="latest" {% if current_sort == 'latest' %}selected{% endif %}>
          Latest
        </option>
        <option value="oldest" {% if current_sort == 'oldest' %}selected{% endif %}>
          Oldest
        </option>
      </select>
      <noscript>
        <button type="submit" class="btn btn-sm btn-outline-secondary">Apply</button>
      </noscript>
    </form>
  </div>

  <div class="card-body p-0">
    <table class="table table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th>S.No</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Status</th>
          <th>Joined At</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for boy in deliveryboys %}
        <tr>
          <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
          <td>{{ boy.name }}</td>
          <td>{{ boy.phone }}</td>
          <td>
            {% if boy.is_active %}
              <span class="badge bg-success">Active</span>
            {% else %}
              <span class="badge bg-secondary">Inactive</span>
            {% endif %}
          </td>
          <td>{{ boy.created_at|date:"d M Y" }}</td>

          <td class="d-flex gap-1">
            <form action="{% url 'toggle_deliveryboy_status' boy.pk %}" method="post" class="d-inline">
              {% csrf_token %}
              {% if boy.is_active %}
                <button type="submit" class="btn btn-sm btn-outline-warning">
                  Deactivate
                </button>
              {% else %}
                <button type="submit" class="btn btn-sm btn-outline-success">
                  Activate
                </button>
              {% endif %}
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center text-muted py-3">
            No delivery partners found.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if is_paginated %}
  <div class="d-flex justify-content-center mt-3 gap-2">
    {% if page_obj.has_previous %}
      <a
        class="btn btn-sm btn-outline-secondary"
        href="?page={{ page_obj.previous_page_number }}&sort={{ current_sort }}"
      >
        ‚Üê Previous
      </a>
    {% endif %}

    {% if page_obj.has_next %}
      <a
        class="btn btn-sm btn-outline-primary"
        href="?page={{ page_obj.next_page_number }}&sort={{ current_sort }}"
      >
        View More
      </a>
    {% endif %}
  </div>
{% endif %}

{% endblock %}
