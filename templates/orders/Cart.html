{% extends "base.html" %}
{% load cart_tags %}
{% load static %}
{% block title %}Your Cart – Clothify{% endblock %}

{% block content %}

<div class="container my-5">
    
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold">Your Cart</h2>    
        <a href="{% url 'orders_list' %}" class="btn btn-outline-secondary btn-sm">
            View My Orders
        </a>
    </div>

    {% if cart_items %}
    <div class="row g-4">

        <div class="col-md-8">

            <div class="card border-0 shadow-sm rounded-4 p-3">

                {% for item in cart_items %}
                <div class="d-flex align-items-center py-3 border-bottom">

                    <div style="width:80px; height:80px; border-radius:12px; overflow:hidden;"
                         class="me-3">
                        <img src="{{ item.product.product_image.url }}"
                             class="w-100 h-100"
                             style="object-fit:cover;">
                    </div>

                    <div class="flex-grow-1">
                        <h5 class="fw-semibold mb-1">
                            {{ item.product.product_name }}
                        </h5>
                        <div class="text-success fw-bold">
                            ₹{{ item.product.discounted_price|default:item.product.product_price }}
                        </div>
                    </div>

                    <div class="d-flex align-items-center gap-2">
                        <form method="post" action="{% url 'cart' item.product.id %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="decrease">
                            <button class="btn btn-outline-dark btn-sm rounded-pill px-3">
                                <i class="bi bi-dash-lg"></i>
                            </button>
                        </form>

                        <span class="fw-bold">{{ item.quantity }}</span>

                        <form method="post" action="{% url 'cart' item.product.id %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="increase">
                            <button class="btn btn-dark btn-sm rounded-pill px-3">
                                <i class="bi bi-plus-lg"></i>
                            </button>
                        </form>
                    </div>

                    <div class="ms-4 text-end fw-bold">
                        ₹{{ item.quantity|mul:item.product.discounted_price|default:item.product.product_price }}
                    </div>

                </div>
                {% endfor %}
            </div>

        </div>
        <div class="col-md-4">

            <div class="card shadow-sm border-0 rounded-4 p-3">

                <h5 class="fw-bold mb-3">Order Summary</h5>

                <form method="post" action="{% url 'apply_coupon' %}" class="mb-3">
                    {% csrf_token %}
                    <div class="input-group">
                        <input
                            type="text"
                            name="coupon"
                            class="form-control"
                            placeholder="Enter coupon code"
                            {% if coupon %}disabled{% endif %}
                        >
                        <button
                            class="btn btn-dark"
                            type="submit"
                            {% if coupon %}disabled{% endif %}
                        >
                            Apply
                        </button>
                    </div>
                </form>

                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Subtotal:</span>
                    <span class="fw-semibold">₹{{ cart_total }}</span>
                </div>

                {% if discount and discount > 0 %}
                <div class="d-flex justify-content-between mb-2 text-success">
                    <span>
                        Discount {% if coupon %}({{ coupon.coupon }}){% endif %}
                    </span>
                    <span class="fw-semibold">− ₹{{ discount }}</span>
                </div>

                <form method="post" action="{% url 'remove_coupon' %}">
                    {% csrf_token %}
                    <button class="btn btn-link text-danger p-0 mb-2">
                        Remove Coupon
                    </button>
                </form>
                {% endif %}
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Delivery Fee:</span>
                    <span class="fw-semibold">
                        {% if delivery_fee == 0 %}
                            Free
                        {% else %}
                            ₹{{ delivery_fee }}
                        {% endif %}
                    </span>
                </div>

                <hr>

                <div class="d-flex justify-content-between mb-3">
                    <span class="fw-bold fs-5">Total:</span>
                    <span class="fw-bold fs-5">₹{{ final_total }}</span>
                </div>

                <a href="{% url 'check_details' %}" class="btn btn-primary btn-lg w-100">
                    Check Details
                </a>

            </div>

        </div>

    </div>

    {% else %}
    <div class="text-center my-5 py-5">

        <img src="https://cdn-icons-png.flaticon.com/512/2037/2037452.png"
             width="150" class="mb-4">

        <h3 class="fw-bold">Your Cart is Empty</h3>
        <p class="text-muted">Looks like you haven’t added anything yet.</p>

        <a href="{% url 'products_list' %}"
           class="btn btn-primary px-4 py-2 rounded-pill fw-semibold mt-3">
            Shop Now
        </a>

    </div>

    {% endif %}

</div>

{% endblock %}
